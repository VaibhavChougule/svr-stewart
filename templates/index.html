<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stewart Platform</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html,
        body {
            height: 100%;
            overflow: hidden;
            /* Prevent scrolling */
        }

        body {
            display: flex;
            flex-direction: column;
        }

        .header {
            /* grid-column: 1 / 4; */
            display: flex;
            height: 60px;
            justify-content: center;
            align-items: center;
            gap: 10px;
            /* padding: 10px 0; */
            background-color: #333;
            color: white;
            /* border-radius: 5px; */
            /* margin: 2px; */

        }

        /* Header Section */

        .header h1 {
            display: inline;
            background-color: rgb(88, 80, 61);
            padding: 2px;
            border-radius: 10px;
        }

        .header p {
            display: inline;
        }


        /* Main container */
        .main-container {
            flex: 1;

            width: 100%;

            background-color: antiquewhite;
            display: flex;
        }

        .left {
            flex: 2;
        }

        .right {
            flex: 1;
            width: 100%;
            display: flex;
            flex-direction: column;
            gap: 0px;
        }


        .plus {
            display: flex;
            flex-direction: row;
            justify-content: space-around;
        }

        .container {
            flex: 1;
            display: flex;
            /* max-width: 30%; */
            margin: 5px;
            padding: 20px;
            background-color: #fff;
            border: 2px solid #ccc;
            border-radius: 8px;
        }

        .ActuatorControl {
            margin: 5px;
        }


        #plot-div {
            /* flex: 1; */
            /* margin: 20px; */
            /* max-width: 30%; */
            /* margin: 0px; */
            /* padding: 20px; */
            background-color: #fff;
            border: 2px solid #ccc;
            border-radius: 8px;

        }




        .section {
            flex: 1;

            background: #ffffff;
            padding: 15px;
            border-radius: 5px;
        }

        .section h3 {
            margin-top: 0;
        }

        .slider {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .slider input[type="range"] {
            width: 70%;
        }

        .control-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
        }

        .control-buttons button {
            padding: 10px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        .control-buttons .on {
            background-color: #4caf50;
            color: white;
        }

        .control-buttons .off {
            background-color: #f44336;
            color: white;
        }

        .feedback {
            text-align: center;
        }

        .feedback img {
            max-width: 100%;
            border-radius: 5px;
        }

        /* .axis-trajectory table {
            width: 100%;
            border-collapse: collapse;
            text-align: center;
        } */

        /* .axis-trajectory table,
        .axis-trajectory th,
        .axis-trajectory td {
            border: 1px solid #ccc;
        }

        .axis-trajectory th,
        .axis-trajectory td {
            padding: 8px;
        }

        .axis-trajectory input {
            width: 80%;
            padding: 5px;
            border: 1px solid #ccc;
            border-radius: 5px;
            text-align: center;
        } */

        button {
            background-color: #4caf50;
            height: 20px;
            width: 50px;
        }

        .plus2 {
            display: flex;
            flex-direction: row;
            gap: 50px;
            padding: 10px;
            justify-content: space-around;
            border: 2px solid black;
            border-radius: 5px;
            margin: 5px;
            background-color: aliceblue;

        }

        .plus2 div {
            padding: 10px;
            border-radius: 10px;
        }

        .table-container {
            /* border: 1px solid black; */
            /* Outer border */
            border-collapse: collapse;
            /* Collapse cell borders */
            /*margin: 20px auto;  Center the table */
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            /* Adjust width to content */
        }

        .table-container2 {
            width: 95%;
        }

        .table-title {
            text-align: center;
            font-weight: bold;
            padding: 0px;
            border-bottom: 1px solid black;
        }

        .axis-table {
            width: 100%;
            border-collapse: collapse;
            /* Collapse cell borders */
        }

        .axis-table th,
        .axis-table td {
            width: 25%;
            border: 1px solid black;
            /* Cell borders */
            padding: 5px;
            /* Add some padding to cells */
            text-align: center;
            /* Center text in cells */
        }

        .axis-table th {
            font-weight: normal;
            /* Make headers normal weight */
        }

        .plus3 {
            padding: 10px;
            /* border: 1px black solid; */
            margin: 5px;
            border-radius: 10px;
            background-color: aliceblue;
        }

        .teach {
            display: flex;
            gap: 10px;
            align-items: center;
            justify-content: space-around;
            border-radius: 5px;
            /* border: black 2px solid; */
        }


        .teach h1 {
            border: 1px black solid;
            padding: 5px;
            border-radius: 5px;
            background-color: darkgray;
        }

        .teach h3 {
            border: 1px black solid;
            padding: 5px;
            border-radius: 5px;
            width: 50px;
        }

        .teach input {
            text-align: center;
            height: 40px;
            width: 120px;
            border-radius: 10px;
            background-color: rgb(205, 205, 205);
        }

        #teach1 {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        #teach2 {
            display: flex;
            gap: 20px;
        }

        #nc {
            width: 100px;
            height: 1.6rem;
            border-radius: 5px;
        }

        #pc {
            width: 100px;
            height: 1.6rem;
            border-radius: 5px;
        }

        #nc:hover {
            background-color: yellowgreen;
        }

        #pc:hover {
            background-color: yellowgreen;
        }

        .logsIn {
            display: flex;
            align-items: center;
            gap: 10px;
            justify-content: space-between;

        }

        .logs {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .logs2 {
            display: flex;

        }

        .switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider2 {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            -webkit-transition: .4s;
            transition: .4s;
        }

        .slider2:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            -webkit-transition: .4s;
            transition: .4s;
        }

        input:checked+.slider2 {
            background-color: #2196F3;
        }

        input:focus+.slider2 {
            box-shadow: 0 0 1px #2196F3;
        }

        input:checked+.slider2:before {
            -webkit-transform: translateX(26px);
            -ms-transform: translateX(26px);
            transform: translateX(26px);
        }

        /* Rounded sliders */
        .slider2.round {
            border-radius: 34px;
        }

        .slider2.round:before {
            border-radius: 50%;
        }

        .slider-container {
            display: flex;
            align-items: center;
        }

        .slider-container :nth-child(2) {
            padding: 10px;
            margin: 5px;
            flex: 1;
            /* background-color: darkgrey; */

        }

        .slider-container :nth-child(1) {
            flex: 1;
            width: 180px;
            padding: 10px;
            margin: 5px;
            background-color: darkgrey;
            border-radius: 5px;


        }

        .slider-container :nth-child(3) {
            flex: 1;
        }

        .social {
            height: 80px;
            width: 80px;
            /* border: 1px black solid; */
            border-radius: 50%;
        }

        #calibration {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            margin-top: 5px;
        }

        .crosshair-button {
            width: 60px;
            height: 60px;
            border: 2px solid black;
            border-radius: 10%;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            background-color: white;
            cursor: pointer;
        }

        .crosshair-button::before,
        .crosshair-button::after {
            content: "";
            position: absolute;
            background-color: black;
        }

        /* Vertical Line */
        .crosshair-button::before {
            width: 2px;
            height: 70%;
        }

        /* Horizontal Line */
        .crosshair-button::after {
            width: 70%;
            height: 2px;
        }

        .outer-circle {
            position: absolute;
            width: 90%;
            height: 90%;
            border: 2px solid black;
            border-radius: 50%;
        }

        .inner-circle {
            position: absolute;
            width: 40%;
            height: 40%;
            border: 2px solid black;
            border-radius: 50%;
        }

        .button-container {
            display: flex;
            gap: 20px;
            align-items: center;
        }

        .connect-button,
        .disconnect-button {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 50px;
            height: 50px;
            border: 2px solid transparent;
            border-radius: 50%;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            color: white;
            position: relative;
        }

        .connect-button {
            background-color: yellowgreen;
        }

        .disconnect-button {
            background-color: red;
        }

        .connect-button svg,
        .disconnect-button svg {
            position: absolute;
            width: 30px;
            height: 30px;
        }

        .connect-label,
        .disconnect-label {
            text-align: center;
            margin-top: 10px;
            font-family: Arial, sans-serif;
            font-size: 14px;
        }

        .connect-label {
            color: yellowgreen;
            font-weight: bolder;
        }

        .disconnect-label {
            color: red;
        }

        #soc {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-top: 5px;
        }

        #soc2 {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-top: 5px;
        }

        .media {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 10px;
            gap: 5px;
        }

        .xyz {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .both {
            background-color: red;
            display: flex;
            padding: 5px;
            border-radius: 5px;
        }

        .dis {
            display: flex;
            /* justify-content: center; */
            align-items: center;
            padding: 2px 10px;
            gap: 10px;
        }

        #credit {
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: #333;
            color: white;
            border: none;
            padding: 5px;
            border-radius: 5px;
            cursor: pointer;
        }

        #popup {
            position: absolute;
            top: 40px;
            right: 10px;
            background-color: #f1f1f1;
            color: #333;
            padding: 10px;
            border-radius: 5px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            display: none;
            z-index: 1000;
        }
    </style>
</head>

<body>
    <div class="header">
        <p>IP Address: {{ip | safe}}</p>
        <h1>STEWART PLATFORM</h1>
        <p>By SVR Robotics Pvt Ltd</p>

    </div>
    <button id="credit">credit</button>
    <div id="popup" style="display:none;">
        <h3>SVR Robotics Team:</h3>
        <a href="https://www.linkedin.com/in/vaibhavchougule475">
            <p style="font-weight:bold;">Vaibhav Chougule</p>
        </a>
        <p style="font-weight:bold;">Ankita Bhosale</p>
        <p style="font-weight:bold;">Sakshi Ghodke</p>
    </div>





    <div class="main-container">
        <div class="left">
            <div class="plus">
                <div class="container">
                    <!-- Main Control Section -->
                    <div class="main-control">

                        <h3>Axis jogging</h3>
                        <form id="control-form">
                            <div class="slider-container">
                                <label class="slider-label" for="offset_x">Offset X:</label>
                                <input type="range" id="offset_x" name="offset_x" min="-500" max="500" step="50"
                                    value="0">
                                <span id="offset_x_value">0</span>
                            </div>
                            <div class="slider-container">
                                <label class="slider-label" for="offset_y">Offset Y:</label>
                                <input type="range" id="offset_y" name="offset_y" min="-500" max="500" step="50"
                                    value="0">
                                <span id="offset_y_value">0</span>
                            </div>

                            <div class="slider-container">
                                <label class="slider-label" for="offset_z">Offset Z:</label>
                                <input type="range" id="offset_z" name="offset_z" min="0" max="450" step="50" value="0">
                                <span id="offset_z_value">0</span>
                            </div>
                            <div class="slider-container">
                                <label class="slider-label" for="offset_yy">Roll:</label>
                                <input type="range" id="offset_yy" name="roll" min="-100" max="100" step="5" value="0">
                                <span id="offset_yy_value">0</span>
                            </div>


                            <div>



                                <!-- <form id="control-form-3"> -->
                                <div class="slider-container">
                                    <label class="slider-label" for="offset_p">Pitch:</label>
                                    <input type="range" id="offset_p" name="pitch" min="-100" max="100" step="5"
                                        value="0">
                                    <span id="offset_p_value">0</span>
                                </div>

                                <div class="slider-container">
                                    <label class="slider-label" for="rotation">Yaw (°):</label>
                                    <input type="range" id="rotation" name="rotation" min="-0.8hui" max="0.8" step="0.1"
                                        value="0">
                                    <span id="rotation_value">0</span>
                                </div>
                                <!-- </form> -->
                        </form>
                    </div>
                </div>
            </div>
            <!-- Actuator Control Section -->
            <div class="section ActuatorControl">
                <h3>Actuator Control</h3>
                <!-- <div class="slider"><label>ACT 1</label><input type="range" min="0" max="100" value="50"></div>
                <div class="slider"><label>ACT 2</label><input type="range" min="0" max="100" value="50"></div>
                <div class="slider"><label>ACT 3</label><input type="range" min="0" max="100" value="50"></div>
                <div class="slider"><label>ACT 4</label><input type="range" min="0" max="100" value="50"></div>
                <div class="slider"><label>ACT 5</label><input type="range" min="0" max="100" value="50"></div>
                <div class="slider"><label>ACT 6</label><input type="range" min="0" max="100" value="50"></div>
                 -->
                <form id="actuator_form">
                    <div class="slider-container">
                        <label class="slider-label" for="act_1">ACTUATOR 1:</label>
                        <input type="range" id="act_1" name="act_1" min="0" max="100" step="10" value="0">
                        <span id="act_1_value">0</span>
                    </div>
                    <div class="slider-container">
                        <label class="slider-label" for="act_2">ACTUATOR 2:</label>
                        <input type="range" id="act_2" name="act_2" min="0" max="100" step="10" value="0">
                        <span id="act_2_value">0</span>
                    </div>
                    <div class="slider-container">
                        <label class="slider-label" for="act_3">ACTUATOR 3:</label>
                        <input type="range" id="act_3" name="act_3" min="0" max="100" step="10" value="0">
                        <span id="act_3_value">0</span>
                    </div>
                    <div class="slider-container">
                        <label class="slider-label" for="act_4">ACTUATOR 4:</label>
                        <input type="range" id="act_4" name="act_4" min="0" max="100" step="10" value="0">
                        <span id="act_4_value">0</span>
                    </div>
                    <div class="slider-container">
                        <label class="slider-label" for="act_5">ACTUATOR 5:</label>
                        <input type="range" id="act_5" name="act_5" min="0" max="100" step="10" value="0">
                        <span id="act_5_value">0</span>
                    </div>
                    <div class="slider-container">
                        <label class="slider-label" for="act_6">ACTUATOR 6:</label>
                        <input type="range" id="act_6" name="act_6" min="0" max="100" step="10" value="0">
                        <span id="act_6_value">0</span>
                    </div>
                </form>
            </div>

        </div>
        <div class="plus2">
            <div style="background-color: #b5b5b5; border: 1px black solid;">
                <h3>Drill Gun Control</h3>
                <label class="switch">
                    <input type="checkbox">
                    <span class="slider2 round" id="dgc"></span>
                </label>
                <h3 style="float: right; margin-top: 5px; margin-right: 30px; color: red; font-weight: bolder;"
                    id="dgctext">Start</h3>
            </div>
            <div style="background-color: #b5b5b5; border: 1px black solid;">
                <h3>Wave Action</h3>
                <label class="switch">
                    <input type="checkbox">
                    <span class="slider2 round" id="wa"></span>
                </label>
                <h3 style="float: right; margin-top: 5px; margin-left: 10px; color: red; font-weight: bolder;"
                    id="watext">Start</h3>
            </div>
            <div style="background-color: #b5b5b5; border: 1px black solid;">
                <h3>Joystick Control</h3>
                <label class="switch">
                    <input type="checkbox">
                    <span class="slider2 round" id="jc"></span>
                </label>
                <h3 style="float: right; margin-top: 5px; margin-right: 20px; color: red; font-weight: bolder;"
                    id="jctext">Start</h3>
            </div>

        </div>
        <div class="plus3">
            <div class="teach">
                <div id="teach1">
                    <h1>Teach Stewart Platform</h1>

                    <input type="number" max="430" placeholder="Ending Point" id="end"></input>
                    <label class="switch">
                        <input type="checkbox">
                        <span class="slider2 round" id="teach"></span>
                    </label>
                </div>
                <div id="teach2">
                    <div><button id="nc">normal Control</button></div>
                    <div><button id="pc">PID Control</button></div>
                </div>
            </div>
            <div class="logs">
                <div class="logsIn">
                    <h2>ERROR LOGS: </h2>
                    <p style="color: green; font-weight: bolder;" id="err">HEALTHY</p>
                </div>
                <div class="logs2">
                    <div class="social" id="calibration">
                        <button class="crosshair-button" id="cal">
                            <div class="outer-circle"></div>
                            <div class="inner-circle"></div>
                        </button>
                        <div>Homing</div>

                    </div>
                    <div class="both">
                        <div class="social" id="soc">
                            <div class="xyz">
                                <div class="connect-button">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="white">
                                        <circle cx="12" cy="12" r="11" stroke="white" stroke-width="2" fill="none">
                                        </circle>
                                        <path d="M8 12h4l2-2 2 2-2 2-2-2H8z" fill="white"></path>
                                    </svg>
                                </div>
                                <div class="connect-label">Connect</div>
                            </div>

                        </div>
                        <div class="social" id="soc2">
                            <div class="xyz">
                                <div class="disconnect-button">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="white">
                                        <circle cx="12" cy="12" r="11" stroke="white" stroke-width="2" fill="none">
                                        </circle>
                                        <path d="M8 12h4l2-2m2 2l-2 2" stroke="white" stroke-width="2" fill="none">
                                        </path>
                                    </svg>
                                </div>
                                <div class="disconnect-label">Disconnected</div>
                            </div>

                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>



    <div class="right">
        <div id="plot-div">
            {{ plot_div | safe }}
        </div>
        <div class="dis">
            <label for="distance">Distance:</label>
            <input type="number" name="" id="distance" placeholder="0" readonly>
            <button id="reflect" style="background-color: red;">Reflect</button>

        </div>
        <div class="table-container">
            <div class="table-container2" style="background-color:rgb(133, 133, 169)">
                <div class="table-title">AXIS TRAJECTORY</div>
                <table class="axis-table">
                    <!-- <thead>
                        <tr>
                            <th></th>
                            <th></th>
                            <th></th>
                        </tr>
                    </thead> -->
                    <tbody>
                        <tr>
                            <td>x</td>
                            <td id="x"></td>
                            <td>Roll</td>
                            <td id="roll"></td>
                        </tr>
                        <tr>
                            <td>y</td>
                            <td id="y"></td>
                            <td>Pitch</td>
                            <td id="pitch"></td>
                        </tr>
                        <tr>
                            <td>z</td>
                            <td id="z"></td>
                            <td>Yaw</td>
                            <td id="yaw"></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        <div style="background-color: #d4d4d4;" class="media">
            <div>
                <a href="https://www.facebook.com/svrrobotics?mibextid=ZbWKwL"><i
                        class="fa-brands fa-facebook fa-2xl"></i></a>
                <a href="https://www.youtube.com/@svrrobotics100"><i class="fa-brands fa-youtube fa-2xl"></i></a>
                <a href="https://www.instagram.com/_____svr.robotics/#"><i
                        class="fa-brands fa-instagram fa-2xl"></i></a>
                <a href="mailto:support@svrrobotics.com"><i class="fa-regular fa-envelope fa-2xl"></i></a>

            </div>
            <div>SVR Robotics Pvt. Ltd. All rights reserved.</div>
        </div>

    </div>




    </div>
    <script>

        let dgc = false;
        let jc = false;
        let nc = false;
        let pc = false;
        let teaching = false;
        let reflect = false;
        let wa =false;
        // Update slider values in real time
        $("input[type='range']").on("input", function () {
            console.log("value changed");

            if ($(this).attr("id") === "offset_z") {
                let id = $(this).attr("id");
                $("#" + id + "_value").text($(this).val());
                return;
            }

            let id = $(this).attr("id");
            // console.log("jd:", $("#offset_x_value"));
            console.log(id);
            let maxValue = $(this).attr("max");
            let val = Math.floor((($(this).val()) / maxValue) * 100) + "%";
            console.log("jglkdha:", val);

            $("#" + id + "_value").text(val);
        });
        //credit 

        $(document).ready(function () {
            $('#credit').click(function () {
                $('#popup').fadeIn();
            });

            // Optional: Hide the popup after a few seconds or when clicked outside
            $(document).click(function (event) {
                if (!$(event.target).closest('#popup, #credit').length) {
                    $('#popup').fadeOut();
                }
            });
        });


        // Handle form changes and send AJAX request

        let connected = false;



        $("#control-form input, #actuator_form input").on("input", function () {
            // Gather form data
            console.log("sending req");

            if (connected) {
                console.log("here");
                let FormData1 = $("#control-form").serialize();
                let FormData2 = $("#actuator_form").serialize();
                console.log("1:", FormData1 + FormData2);
                let FullFormData = FormData1 + "&" + FormData2;


                let formData = $(this).closest("form").serialize();
                console.log("element:", $(this).closest("form"));
                console.log("formData:", FullFormData);

                console.log(typeof formData);

                // Send AJAX POST request
                $.post("/update_plot", FullFormData, function (data) {
                    // Replace the plot with the updated one
                    $("#plot-div").html(data.plot_html);
                });
            } else {
                alert("Plz connect first")
                for (let i = 0; i < 12; i++) {
                    //console.log("s:" , i);
                    $("input[type='range']")[i].value = 0;

                }
                let id = $(this).attr("id");
                // console.log("jd:", $("#offset_x_value"));
                console.log(id);

                $("#" + id + "_value").text($(this).val());
            }
        });



        //Calibration function
        console.log($('#cal'));

        $("#cal").on('click', function () {
            console.log("Reseting");
            $.post('/calibrate', function (data) {
                console.log("data:", data);
            })
            console.log("jjjhhg", $("input[type='range']")[0])
            for (let i = 0; i < 12; i++) {
                console.log("s:", i);
                $("input[type='range']")[i].value = 0;

            }

            let FormData1 = $("#control-form").serialize();
            let FormData2 = $("#actuator_form").serialize();
            console.log("1:", FormData1 + FormData2);
            let FullFormData = FormData1 + "&" + FormData2;

            $.post('/update_plot', FullFormData, function (data) {
                $('#plot-div').html(data.plot_html);
            })
            $('.slider-container span').text(0);
        })

        //roll 
        $('#offset_yy').on('input', function () {
            console.log("roll changed");


        })

        $('.connect-button').on('click', function () {
            console.log("connected");
            $.post('/connect', function (data) {
                console.log("data:", data);
            })
            if (!connected) {
                connected = true;
                console.log($('.connect-label').text);

                $('.connect-label').text("Connected")
                $('.disconnect-label').text("Disconnect")
                $('.both').css("background-color", "yellowgreen")
            }
            else {
                alert("Already connected..");

            }

        })
        $('.disconnect-button').on('click', function () {
            console.log("disconnected");
            $.post('/disconnect', function (data) {
                console.log("data:", data);
            })
            if (connected) {
                connected = false;


                $('.disconnect-label').text("Disconnected")
                $('.connect-label').text("Connect")
                $('.both').css("background-color", "red")
            }
            else {

                alert("Already disconnected..");

            }

        })
        $('#dgc').on('click', function () {
            console.log("dgc clicked");

            if (dgc) {
                dgc = false;
                $('#dgctext').text("Start");
                let FormData1 = $("#control-form").serialize();
                let FormData2 = $("#actuator_form").serialize();
                console.log("1:", FormData1 + FormData2);
                let FullFormData = FormData1 + "&" + FormData2 + "&" + `dgc=False`;
                console.log("with drill:", FullFormData);
                $.post('/update_plot', FullFormData, function (data) {
                    $('#plot-div').html(data.plot_html);
                })
                $.post('/update_dgc' , 'dgc=False' , function(data){
                    console.log("data:", data);
                })
            }
            else {
                dgc = true;
                $('#dgctext').text("Stop");
                let FormData1 = $("#control-form").serialize();
                let FormData2 = $("#actuator_form").serialize();
                console.log("1:", FormData1 + FormData2);
                let FullFormData = FormData1 + "&" + FormData2 + "&" + `dgc=True`;
                console.log("with drill:", FullFormData);

                $.post('/update_plot', FullFormData, function (data) {
                    $('#plot-div').html(data.plot_html);
                })
                $.post('/update_dgc' , 'dgc=True' , function(data){
                    console.log("data:", data);
                })
            }
        })

        $('#wa').on('click', function(){
            
            if(wa){
                wa = false;
                $('#watext').text("Start");
                $.post('/wave_action', 'wa=False', function(data){
                console.log("data:", data);
            })
            }
            else{
                wa = true;
                $('#watext').text("Stop");
                $.post('/wave_action', 'wa=True', function(data){
                console.log("data:", data);
            })
            }
           
        })
        let intervalId;
        $('#jc').on('click', function () {
            console.log("jc clicked");
            
            if (jc) {
                jc = false;
                // clearInterval(intervalId);
                $('#jctext').text("Start");
                $.post('/joystick_control', 'jc=False', function (data) {
                console.log("data:", data);
            })
                // intervalId = null;
            }
            else {
                jc = true;
                $('#jctext').text("Stop");
                $.post('/joystick_control', 'jc=True', function (data) {
                console.log("data:", data);
            })
                // intervalId = setInterval(fetchAndUpdatePlot, 2000);
                // fetchAndUpdatePlot();
            }
        })


        $('#teach').on('click', function () {
            console.log("teach clicked");
            

            if (teaching) {
                teaching = false;
                $('#teach').css("background-color", "red");
                // $('#end').value();
                console.log("end:", $('#end').val());
                $.post('/teach', 'teach=False', function (data) {
                console.log("data:", data);
            })
                // alert("Teaching OFF");
            }
            else {
                teaching = true;
                $('#teach').css("background-color", "green");
                
                let d = 'teach=True&end=' + $('#end').val();
                $.post('/teach', d, function (data) {
                console.log("data:", data);
            })
                // alert("Teaching ON");
            }
        })

        $('#nc').on('click', function () {
            console.log("nc clicked");
            
            if (teaching) {
                if (nc) {
                    nc = false;
                    $('#nc').css("background-color", "red");
                    $('#pc').css("background-color", "green");
                    $.post('/normal_control','nc=False' , function (data) {
                    console.log("data:", data);
            })
                    alert("Normal Control OFF");
                }
                else {
                    nc = true;
                    $('#nc').css("background-color", "green");
                    $('#pc').css("background-color", "red");
                    $.post('/normal_control','nc=True' , function (data) {
                    console.log("data:", data);
            })
                    alert("Normal Control ON");
                }
            }



        })

        $('#pc').on('click', function () {
            console.log("pc clicked");
            
            if (teaching) {
                if (pc) {
                    pc = false;
                    $('#pc').css("background-color", "red");
                    $('#nc').css("background-color", "green");
                    $.post('/pid_control','pc=True', function (data) {
                    console.log("data:", data);
            })
                    alert("PID Control OFF");
                }
                else {
                    pc = true;
                    $('#pc').css("background-color", "green");
                    $('#nc').css("background-color", "red");
                    $.post('/pid_control','pc=True', function (data) {
                console.log("data:", data);
            })
                    alert("PID controll ON");
                }
            }
        })
        function reflectIt(){
            $.get('/get_coordinates', function (data) {
                    console.log("data:", data.coordinates);
                    $('#x').text(data.coordinates[0]);
                    $('#y').text(data.coordinates[1]);
                    $('#z').text(data.coordinates[2]);
                    $('#roll').text(data.coordinates[3]);
                    $('#pitch').text(data.coordinates[4]);
                    $('#yaw').text(data.coordinates[5]);
                    let newData = `offset_x=${data.coordinates[0]}&offset_y=${data.coordinates[1]}&offset_z=${data.coordinates[2]}&roll=${data.coordinates[3]}&pitch=${data.coordinates[4]}&rotation=${data.coordinates[5]}`;
                    if(reflect){

                        $.post('/update_plot', newData, function (data) {
                            $('#plot-div').html(data.plot_html);
                        })
                    }

                })
        }
        intervalId = setInterval(reflectIt, 1000);
        //Axis Trajectory control
        $('#reflect').on('click', function () {
            if (reflect) {
                reflect = false;
                this.style.backgroundColor = "red";
                clearInterval(intervalId);
            }
            else {
                reflect = true;
                this.style.backgroundColor = "green";
                
                
            }
        })


        $.get('/get_distance', function (data) {
            console.log("distance:", data.distance);
            $('#distance').val(data.distance);
        })

        $.get('/get_logs', function (data) {
            console.log("error:", data.logs);
            $('#err').text(data.logs);
        })

        $('#end').on('input', function () {
            if ($(this).val() > 430) {
                alert("Value should be less than 430");
                $(this).val(430);
            }
        })

        function fetchValue() {
            $.get('/get-value', function (data) {
                console.log("value fetching");
                console.log(data.value);

                $('#display').text(data.value); // Update the <p> element with the fetched value
            }).fail(function () {
                console.error("Error fetching value from the server.");
            });
        }

        // Poll the server every 1 second
        // setInterval(fetchValue, 3000);
        function fetchAndUpdatePlot() {

            $.get("/update_from_serial", function (data) {
                if (data.plot_html) {
                    console.log("herereeererere");

                    $("#plot-div").html(data.plot_html);  // Update the plot
                }
            });

            // $.get("/update_from_serial", function (data) {
            //     if (data.plot_html) {
            //         console.log("herereeererere");

            //         $("#plot-div").html(data.plot_html);  // Update the plot
            //     }
            // });
        }




    </script>
</body>

</html>